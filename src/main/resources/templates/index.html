<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지도 기반 SNS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
        #map { width: 100%; height: 100vh; }
        #map-placeholder {
            width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center;
            background: #f0f4f8; color: #334155; text-align: center; padding: 2rem;
        }
        #map-placeholder p { margin: 1rem 0; line-height: 1.6; }
        .info-window { padding: 8px 12px; max-width: 280px; }
        .info-window h4 { margin-bottom: 6px; font-size: 14px; }
        .info-window a { color: #2563eb; text-decoration: none; font-size: 13px; }
        .info-window a:hover { text-decoration: underline; }
        .info-window ul { list-style: none; margin-top: 8px; }
        .info-window li { margin: 4px 0; }
    </style>
</head>
<body>
    <!-- Step 13: 게시글 작성 링크 -->
    <nav style="position:fixed;top:0;right:0;z-index:1000;padding:0.5rem 1rem;background:rgba(255,255,255,0.9);border-radius:0 0 0 8px;">
        <a th:href="@{/login}" style="margin-right:0.5rem;">로그인</a>
        <a th:href="@{/posts/create}">게시글 작성</a>
        <a th:href="@{/image-posts/create}" style="margin-left:0.5rem;">이미지 작성</a>
    </nav>
    <!-- RULE 1.5.6: 사용자 입력은 th:text로 이스케이프. th:utext는 신뢰할 수 있는 데이터만. -->
    <div id="map"></div>
    <div id="map-placeholder" style="display:none;">
        <div>
            <p><strong>지도를 표시하려면 카카오맵 API 키가 필요합니다.</strong></p>
            <p>환경 변수 <code>MAP_KAKAO_JS_APP_KEY</code>를 설정한 후<br>카카오 개발자 콘솔에서 JavaScript 키를 등록하세요.</p>
            <p style="font-size:0.9em;color:#64748b;">localhost 개발 시 http://localhost:8080 도메인 등록 필요</p>
        </div>
    </div>

    <!-- Step 12: 카카오맵 JS API. appkey는 서버에서 주입. RULE 1.1: 키는 환경변수. -->
    <script th:if="${kakaoMapScriptUrl != null and !kakaoMapScriptUrl.isEmpty()}" th:src="${kakaoMapScriptUrl}"></script>
    <script th:src="@{/js/map.js}"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.MAP_KAKAO_APP_KEY = /*[[${kakaoJsAppKey}]]*/ '';
        window.MAP_API_BASE = /*[[@{/api}]]*/ '/api';
        /*]]>*/
    </script>
</body>
</html>
